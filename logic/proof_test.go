package logic

import (
	"encoding/json"
	"github.com/mapprotocol/zk-map-server/entity"
	"testing"
)

var body = `{
	"bit_map": [0, 1, 1, 1, 0, 0, 0, 0],
	"commitment": ["8578782065241552891711616656753831285837511113519902609598551935173430613289"],
	"hash": [
		["6911510433611", "4938476855354", "3865114216620", "38820734594", "1253936250528", "157501582046"],
		["8697328845417", "537070119816", "4990022761643", "3470073521273", "254885637361", "329399051208"]
	],
	"pubkeys": [
		[
			[
				["6953956819063", "4552609510709", "6162164087784", "4355635563321", "2327799413362", "88478273526"],
				["8591366933356", "60323095689", "537971605702", "3675654501785", "783863578371", "217717611619"]
			],
			[
				["89976646327", "7479577663731", "3464715306388", "6580347374497", "1453867527355", "380166188112"],
				["6442682768331", "6556920067489", "6902715326104", "7052190856939", "6903915298356", "150654809563"]
			]
		],
		[
			[
				["5968792621112", "5408711945336", "683708763817", "2895176250368", "4219104041013", "256004736008"],
				["5604858558619", "5173616933447", "83209144894", "3049054127956", "8025243603937", "327577510670"]
			],
			[
				["5534647587514", "6902115210896", "65139549692", "6030635616222", "4200432417456", "333338043126"],
				["1290275831976", "5924186243167", "1150691172641", "4189724278172", "2268245783986", "205152344533"]
			]
		],
		[
			[
				["7727304524999", "7601026699978", "2273152849547", "2526309438113", "4981073250939", "142698982226"],
				["5606522196634", "4242546120764", "2051070429460", "3858258641412", "7313296679037", "180124631651"]
			],
			[
				["8352539021050", "1221772785778", "968704321260", "6059860603429", "8117865512726", "91811565817"],
				["1055622714388", "4550685646997", "4790113067361", "6736740389338", "3616142915113", "89629350255"]
			]
		],
		[
			[
				["5180841903981", "5171556524897", "4205908164529", "2916794805317", "1171704191225", "61084090461"],
				["1402910938352", "4627197081573", "1259582700279", "3368679690062", "2855232477010", "230141045188"]
			],
			[
				["1493500670651", "4359178956987", "1470071953392", "2671801867709", "204371507498", "65621445245"],
				["2636269828045", "904844783676", "3262148135497", "5478674325228", "4584479106801", "59084050421"]
			]
		],
		[
			[
				["831351778325", "5443414731161", "8673730400374", "3440779160775", "5889428905254", "15024912336"],
				["1492142943393", "2295244213377", "5282713506530", "4955879850356", "8595964704484", "110334541215"]
			],
			[
				["7982175408486", "5851279447863", "2457632767187", "7316282537973", "3150276908035", "384597809018"],
				["614780992588", "3200307451611", "5675089874979", "8552299189311", "74567198820", "9151596975"]
			]
		],
		[
			[
				["2528822813897", "130768405377", "6430337683423", "1133646842225", "2618399116524", "234679516034"],
				["744652323941", "3261456554419", "3969310411577", "749585197112", "6723402439445", "174932117880"]
			],
			[
				["4345568510968", "4811304631872", "264778026210", "577545117390", "1548717359547", "341476008202"],
				["5172112967963", "4137520091444", "7447375101519", "8659940794972", "1979587126919", "402620774573"]
			]
		],
		[
			[
				["2494732822534", "820147817589", "5872216234261", "4186431300386", "2292395041442", "263935430324"],
				["3517415412848", "7007450907862", "7845125499962", "6153781185574", "413099343759", "407240772363"]
			],
			[
				["3176784127874", "6457692190952", "8788454541024", "2355510822127", "7103697525817", "292985850236"],
				["6499350534910", "7109555267613", "1170305090433", "208940417393", "77017878980", "138253859918"]
			]
		],
		[
			[
				["4158779429942", "7521602261606", "1119939228096", "7922260552464", "2635214118410", "29151677888"],
				["3551666964468", "547722511195", "6761646163951", "1865670703453", "1021250223499", "80207163577"]
			],
			[
				["6186215084897", "8200160115113", "2257564207354", "2056200699113", "5377007611462", "84316481989"],
				["2515131168349", "7155978454447", "429337332141", "668141023994", "1203835686759", "262157118957"]
			]
		]
	],
	"signature": [
		["1689672953385", "3288697111970", "2040692154107", "3160663793703", "2657041068421", "255013264967"],
		["5929352701412", "8012884604661", "955373168935", "8313405501252", "3361570832681", "359304964313"]
	],
	"weights": [1, 1, 1, 1, 0, 0, 0, 0]
}`

func TestRequestStart(t *testing.T) {
	type args struct {
		url  string
		body string
	}
	tests := []struct {
		name    string
		args    args
		wantErr bool
	}{
		{
			name: "t-1",
			args: args{
				url:  "http://47.242.33.167:18888/start",
				body: body,
			},
			wantErr: false,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			got, err := RequestStart(tt.args.url, tt.args.body)
			if (err != nil) != tt.wantErr {
				t.Errorf("RequestStart() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			t.Logf("RequestStart() got = %v", got)
		})
	}
}

func TestRequestStatus(t *testing.T) {
	type args struct {
		url string
		id  string
	}
	tests := []struct {
		name    string
		args    args
		pending bool
		wantErr bool
	}{
		{
			name: "t-1",
			args: args{
				url: "http://47.242.33.167:18888/status",
				id:  "fa625945-016f-4612-84b7-68aa9f3e80b5",
			},
			wantErr: false,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			got, _, err := RequestStatus(tt.args.url, tt.args.id)
			if (err != nil) != tt.wantErr {
				t.Errorf("RequestStatus() error = %v, wantErr %v", err, tt.wantErr)
				return
			}

			t.Logf("RequestStatus() got = %v", got)

			result := entity.Result{}
			_ = json.Unmarshal([]byte(got), &result)
			t.Logf("RequestStatus() result = %+v", result)

		})
	}
}
